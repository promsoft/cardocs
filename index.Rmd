---
title       : Explore 1974 Motor Trend dataset
subtitle    : with shiny app
author      : Dmitry Kolodezev
job         : student
framework   : html5slides   # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---
## Explore 1974 Motor Trend dataset
```{r main, echo=FALSE}
data(mtcars)
fit <- lm(mpg~am+cyl+am:cyl, mtcars)
res <- residuals(fit)
fits <- fitted(fit)
color0 <- 'turquoise4'
color1 <- 'darkorange'
color2 <- 'gray'

set0 <- mtcars[mtcars$am==0,]
set1 <- mtcars[mtcars$am==1,]

mark.twain <- function(x) {
  parmar <- par('mar')
  par(mar = c(4, 4, 0, 2))
  plot(mtcars[[x]]
       , mtcars$mpg
       , col=ifelse(mtcars$am==0, color0, color1)
       , xlab=x
       , ylab='mpg')
  if(x == 0) {
    fit2 <- lm(mpg~am, mtcars)
    abline(fit2, col=color2, lty=3, lw=2)    
    
  } else {
    formula0 <- paste0('mpg~', x)
    fit0 <- lm(formula(formula0), set0)
    abline(fit0, col=color0, lw=2)
    
    fit1 <- lm(formula(formula0), set1)
    abline(fit1, col=color1, lw=2)
    
    fit2 <- lm(formula(formula0), mtcars)
    abline(fit2, col=color2, lty=3, lw=2)    
  }
  
  legend("topright", pch = c(1, 1, 45, 45, 45)
         , col = c(color0, color1, color0, color1, color2)
         , legend = c("manual", "automatic", "marg. manual", "marg. auto", paste0("mpg~", x))
         )
  f.diff <- summary(fit1)$coeff - summary(fit0)$coeff 
  par(mar=parmar)
}

do.box <- function(x) {
  parmar <- par('mar')
  par(mar = c(4, 4, 0, 2))
  boxplot(formula(paste0(x, '~am'))
          , data = mtcars
          , col = c('turquoise4', 'darkorange')
          , ylab = x
          , names = c('manual', 'automatic'))
  par(mar=parmar)
}
```

If you goal 

1. Edit YAML front matter
2. Write using R Markdown
3. Use an empty line followed by three dashes to separate slides!

---------------------
## Scatterplot
```
Model: lm(mpg~hp) # How cofounder variable linked to mileage
```

```{r scatterplot, echo=FALSE, fig.width=11, fig.height=5}
mark.twain('hp')

```

---------------------
## Regression coefficients
```
Model: lm(mpg~am+cyl+am:cyl)
```
For the complete model, 
you can access R^2 and reqression coeffitients. 

```{r regression, echo=FALSE}
summary(fit)$coeff
```

---------------------
## Box Plot
Cofounder must be similary distributed in both car groups. For example, using number of forward gears as cofounder may be problematic, since number of gears was tightly coupled with transmission type.

```{r qqplot, echo=FALSE, fig.width=11, fig.height=5}
do.box('gear')
```

---------------------
## Resuduals Plot and QQ Plo
```
Model: lm(mpg~am+cyl+am:cyl)
```

```{r resplot, echo=FALSE, fig.width=11, fig.height=5}
#parmar <- par('mar')
par(mfrow = c(1, 2))
#par(mar = c(4, 4, 0, 2))
plot(res ~ fits)
abline(h = 0)

qqnorm(res, main='')
qqline(res, main='')
```

In these pages some model quality assurance tools was available. We can check our data for heterosсedasticity and check residual distribution for normality. 
